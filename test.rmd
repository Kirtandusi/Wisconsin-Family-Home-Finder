---
author: Alexander Wu
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,
                      warning = FALSE, error = TRUE, fig.height = 3)
library(tidyverse)
library(lubridate)
library(kableExtra)
library(broman)
library(scales)
library(modelr)
theme_set(theme_minimal())
```

```{r}
education = read_csv("education.csv")
crime = read_csv("crime.csv")
employment = read_csv("employment.csv")
homeprice = read_csv("homeprice.csv")
```

```{r}
education$`Population`= education$`City&Population`
education$'City' = education$'City&Population'
education = education %>% 
  mutate(City = substr(education$City, 1, str_locate(education$City, ", WI / ") - 1), Population = substr(education$Population, str_locate(education$Population, " / ") + 3, nchar(education$Population))) %>% 
  select(`Average Education Index`, `Population`, `City`) %>% 
  mutate(Population = as.numeric(str_replace(Population, ",", "")))
#education$Population = as.numeric(gsub(",", "", education$Population))
```

```{r}
crime$`Population`= crime$`City&Population`
crime$'City' = crime$'City&Population'
crime = crime %>% 
  mutate(City = substr(crime$City, 1, str_locate(crime$City, ", WI / ") - 1)) %>% 
  select('Crime Index', 'City')
```

```{r}
homeprice$`Population`= homeprice$`City&Population`
homeprice$'City' = homeprice$'City&Population'
homeprice = homeprice %>% 
  mutate(City = substr(homeprice$City, 1, str_locate(homeprice$City, ", WI / ") - 1)) %>% 
  select('House Median Value', 'City')
```

```{r}
employment$`Population`= employment$`City&Population`
employment$'City' = employment$'City&Population'
employment = employment %>% 
  mutate(City = substr(employment$City, 1, str_locate(employment$City, ", WI / ") - 1)) %>%   
	rename('Age 16 or Older Population Employed Percentage' = 'Age 16 or Older Population Percentage') %>% 
	select('Age 16 or Older Population Employed Percentage', 'City')
```

```{r}
final = left_join(education, crime, "City")
final = left_join(final, employment, "City")
final = left_join(final, homeprice, "City")
final = drop_na(final) 
final = final[,c(3, 2, 1, 4, 5, 6)]
max_education_index = max(final$`Average Education Index`)
final = final %>% 
  filter(Population > 1000) %>% 
  rename(city = City, population = Population, average_education_index = "Average Education Index", crime_index = "Crime Index", sixteen_plus_employed_percentage = "Age 16 or Older Population Employed Percentage", house_median_value = "House Median Value") %>% 
  mutate(house_median_value = str_sub(str_replace(house_median_value, ",", ""), 2, -1),
         sixteen_plus_employed_percentage = str_replace(sixteen_plus_employed_percentage, "%", ""),
         edu_index_norm = average_education_index / max_education_index)
final$house_median_value = as.numeric(final$house_median_value)
final$sixteen_plus_employed_percentage = as.numeric(final$sixteen_plus_employed_percentage)
max_employment_percentage = max(final$sixteen_plus_employed_percentage)
final = final %>% 
  mutate(employed_percentage_norm = sixteen_plus_employed_percentage / max_employment_percentage)
ggplot(final, aes(x = crime_index)) +
  geom_density() +
  geom_vline(aes(xintercept=700), color="red", linetype = "dashed")
```

```{r}
final$'' = 1:264
final = final[,c(9, 1, 2, 3, 4, 5, 6, 7, 8)]
write_csv(final, "city_education_crime_employment_homeprice.csv")
print(final$city)
write(final$city, "city_list.txt")
```
